function getRandomInt(n,t){return Math.floor(Math.random()*(t-n+1))+n}(function(){function n(n){$("#cards").empty();$("#leaderboard").addClass("hidden");$.getJSON("/api/species/"+n,function(n){t(n);speciesName=n.name})}function t(t){function tt(){var n=new Date,t=n-d,i=JSON.stringify({id:p,duration:t,finishedTime:n,movesCount:g,speciesName:speciesName});$.ajax({url:"/api/games/",type:"post",data:i,dataType:"json",accept:"application/json",contentType:"application/json"})}function o(n,t){var i=new Date,r,u;r=y!=null?i-y:null;u=JSON.stringify({label:n,card:t,time:i,millisecondsSinceLastEvent:r,gameId:p,speciesName:speciesName});y=i;$.ajax({url:"/api/events/",type:"post",data:u,dataType:"json",accept:"application/json",contentType:"application/json",success:function(n){p=n},error:function(n){alert(n)}})}function it(){var n="/api/leaderboard/"+speciesName;$.getJSON(n,function(n){$("#leaderboard-table").find("tr:gt(0)").remove();$.each(n.items,function(n,t){$("#leaderboard-table").append("<tr><td>"+t.name+"<\/td><td>"+t.movesCount+"<\/td><\/tr>")});$("#leaderboard-name").text(n.name);$("#leaderboard").removeClass("hidden")})}function rt(){if(o("match",a.url),tt(),s>=r)for(var t=0;t<r;t++)console.log(f[t]),$(f[t].cardId).text(f[t].name);$("#next-game").removeClass("hidden").text("next game").off("click").on("click",function(){n("nextrandom")});it()}var k=t.sets,v=!1,r=t.cardCount,ut=t.columnCount,ft=k.length,u=null,s=0,y=null,d=null,p=null,g=0,h,w,f,e,c,b,l,nt,i,a;for($("#next-game").off("click").addClass("hidden"),h=0,w=0,i=0;i<r;i++)h==0&&(rowId="row"+w,$("#cards").append("<div class='row' id='"+rowId+"'><\/div>")),cardId="card"+i,$("#"+rowId).append("<div class='card cardCovered' id='"+cardId+"'><\/div>"),h++,h==ut&&(w++,h=0);for(f=[],e=[],i=0;i<ft;i++)e.push({index:i,weight:getRandomInt(0,1e3),species:k[i]});for(e.sort(function(n,t){return n.weight-t.weight}),speciesIndex=0,i=0;i<r;i+=2,speciesIndex++){for(c=[],b=e[speciesIndex].species.subSets,l=0;l<b.length;l++)nt=getRandomInt(0,b[l].length-1),c.push({weight:getRandomInt(0,1e3),url:e[speciesIndex].species.subSets[l][nt]});c.sort(function(n,t){return n.weight-t.weight});f.push({setIndex:e[speciesIndex].index,weight:getRandomInt(0,1e3),url:c[0].url,name:e[speciesIndex].species.name});f.push({setIndex:e[speciesIndex].index,weight:getRandomInt(0,1e3),url:c[1].url,name:e[speciesIndex].species.name})}for(f.sort(function(n,t){return n.weight-t.weight}),d=new Date,o("started",null),i=0;i<r;i++){f[i].cardId="#card"+i;a=f[i];console.log(a);$(a.cardId).addClass("cardCovered").on("click",a,function(n){var i;if(!v){v=!0;var f=n.data.cardId,e=n.data.url,t=n.data;$(f).addClass("cardPlaying").removeClass("cardCovered").addClass("cardUncovered");i=new Audio(e);i.onended=function(){$(t.cardId).removeClass("cardPlaying");v=!1;console.log("Sound finished for card: ");console.log(t);console.log("First selected card: "+u);console.log(u);s<r?(g++,console.log("matchCount "+s+"; cardCount "+r),u!=null&&u.cardId!=t.cardId?(u.setIndex!=t.setIndex?($(t.cardId).removeClass("cardUncovered"),$(t.cardId).addClass("cardCovered"),$(u.cardId).removeClass("cardUncovered"),$(u.cardId).addClass("cardCovered"),o("mismatch",t.url)):(o("match",t.url),s+=2,console.log(s+", "+r),s>=r&&rt()),u=null):(o("first",t.url),u=t)):o("after the win",t.url)};i.play();console.log("Card selected: ");console.log(t)}})}}n(speciesName)})();