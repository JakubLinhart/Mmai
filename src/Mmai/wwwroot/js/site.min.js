function getRandomInt(n,t){return Math.floor(Math.random()*(t-n+1))+n}(function(){function n(n){for(var r=0;r<t;r++)cardId="#card"+r,$(cardId).removeClass("cardCovered").removeClass("cardUncovered").removeClass("cardPlaying").off("click").empty();$("#leaderboard").addClass("hidden");$.getJSON("/api/species/"+n,function(n){i(n);speciesName=n.name})}function i(t){function g(){var n=new Date,t=n-b,i=JSON.stringify({id:y,duration:t,finishedTime:n,movesCount:k,speciesName:speciesName});$.ajax({url:"/api/games/",type:"post",data:i,dataType:"json",accept:"application/json",contentType:"application/json"})}function s(n,t){var i=new Date,r,u;r=v!=null?i-v:null;u=JSON.stringify({label:n,card:t,time:i,millisecondsSinceLastEvent:r,gameId:y});v=i;$.ajax({url:"/api/events/",type:"post",data:u,dataType:"json",accept:"application/json",contentType:"application/json",success:function(n){y=n},error:function(n){alert(n)}})}function nt(){var n="/api/leaderboard/"+speciesName;$.getJSON(n,function(n){$("#leaderboard-table").find("tr:gt(0)").remove();$.each(n.items,function(n,t){$("#leaderboard-table").append("<tr><td>"+t.name+"<\/td><td>"+t.movesCount+"<\/td><\/tr>")});$("#leaderboard-name").text(n.name);$("#leaderboard").removeClass("hidden")})}function tt(){if(s("match",l.url),g(),o>=e)for(var t=0;t<e;t++)console.log(u[t]),$(u[t].cardId).text(u[t].name);$("#next-game").removeClass("hidden").text("next game").off("click").on("click",function(){n("nextrandom")});nt()}var w=t.sets,a=!1,e=t.cardCount,it=w.length,r=null,o=0,v=null,b=null,y=null,k=0,u,f,h,p,c,d,i,l;for($("#next-game").off("click").addClass("hidden"),u=[],f=[],i=0;i<it;i++)f.push({index:i,weight:getRandomInt(0,1e3),species:w[i]});for(f.sort(function(n,t){return n.weight-t.weight}),speciesIndex=0,i=0;i<e;i+=2,speciesIndex++){for(h=[],p=f[speciesIndex].species.subSets,c=0;c<p.length;c++)d=getRandomInt(0,p[c].length-1),h.push({weight:getRandomInt(0,1e3),url:f[speciesIndex].species.subSets[c][d]});h.sort(function(n,t){return n.weight-t.weight});u.push({setIndex:f[speciesIndex].index,weight:getRandomInt(0,1e3),url:h[0].url,name:f[speciesIndex].species.name});u.push({setIndex:f[speciesIndex].index,weight:getRandomInt(0,1e3),url:h[1].url,name:f[speciesIndex].species.name})}for(u.sort(function(n,t){return n.weight-t.weight}),b=new Date,s("started",null),i=0;i<e;i++){u[i].cardId="#card"+i;l=u[i];console.log(l);$(l.cardId).addClass("cardCovered").on("click",l,function(n){var i;if(!a){a=!0;var u=n.data.cardId,f=n.data.url,t=n.data;$(u).addClass("cardPlaying").removeClass("cardCovered").addClass("cardUncovered");i=new Audio(f);i.onended=function(){$(t.cardId).removeClass("cardPlaying");a=!1;console.log("Sound finished for card: ");console.log(t);console.log("First selected card: "+r);console.log(r);o<e?(k++,console.log("matchCount "+o+"; cardCount "+e),r!=null&&r.cardId!=t.cardId?(r.setIndex!=t.setIndex?($(t.cardId).removeClass("cardUncovered"),$(t.cardId).addClass("cardCovered"),$(r.cardId).removeClass("cardUncovered"),$(r.cardId).addClass("cardCovered"),s("mismatch",t.url)):(o+=2,console.log(o+", "+e),o>=e&&tt()),r=null):(s("first",t.url),r=t)):s("after the win",t.url)};i.play();console.log("Card selected: ");console.log(t)}})}}var t=12;n(speciesName)})();