function getRandomInt(n,t){return Math.floor(Math.random()*(t-n+1))+n}(function(){function n(){var n=JSON.stringify({id:gameId,nickName:$("#nickname").val(),email:$("#email").val()});$.ajax({url:"/api/games/contact",type:"post",data:n,dataType:"json",accept:"application/json",contentType:"application/json"})}function t(n){$("#cards").empty();$("#leaderboard").addClass("hidden");$.getJSON("/api/species/"+n,function(n){speciesName=n.name;i(n)})}function i(n){function it(){var n=new Date,t=n-g,i=JSON.stringify({id:w,duration:t,finishedTime:n,movesCount:nt,speciesName:speciesName});$.ajax({url:"/api/games/finish",type:"post",data:i,dataType:"json",accept:"application/json",contentType:"application/json"})}function rt(){var n=JSON.stringify({duration:null,finishedTime:null,movesCount:null,speciesName:speciesName});$.ajax({url:"/api/games/start",type:"post",data:n,dataType:"json",accept:"application/json",contentType:"application/json",success:function(n){w=n.id},error:function(n){console.log("postGameEvent error: "+n.description)}});o("started",null,null)}function o(n,t,i){var r=new Date,u,f;u=p!=null?r-p:null;f=JSON.stringify({label:n,card:t,time:r,millisecondsSinceLastEvent:u,gameId:w,speciesName:speciesName,row:Math.floor(i/y),column:i%y});p=r;$.ajax({url:"/api/events/",type:"post",data:f,dataType:"json",accept:"application/json",contentType:"application/json",error:function(n){console.log("postGameEvent error: "+n.description)}})}function ut(){var n="/api/leaderboard/top10/"+speciesName;$.getJSON(n,function(n){$("#leaderboard-table").find("tr:gt(0)").remove();$.each(n.items,function(n,t){$("#leaderboard-table").append("<tr><td>"+t.nickName+"<\/td><td>"+t.movesCount+"<\/td><\/tr>")});$("#leaderboard-name").text(n.name);$("#leaderboard").removeClass("hidden")})}function ft(){if(it(),s>=u)for(var n=0;n<u;n++)console.log(r[n]),$(r[n].cardId).text(r[n].name);$("#next-game").removeClass("hidden").text("next game").off("click").on("click",function(){t("nextrandom")});ut()}var d=n.sets,v=!1,u=n.cardCount,y=n.columnCount,et=d.length,f=null,s=0,p=null,g=null,w=null,nt=0,h,b,r,e,c,k,l,tt,i,a;for($("#game-description").text(n.description),$("#next-game").off("click").addClass("hidden"),h=0,b=0,i=0;i<u;i++)h==0&&(rowId="row"+b,$("#cards").append("<div class='row' id='"+rowId+"'><\/div>")),cardId="card"+i,$("#"+rowId).append("<div class='card cardCovered' id='"+cardId+"'><\/div>"),h++,h==y&&(b++,h=0);for(r=[],e=[],i=0;i<et;i++)e.push({index:i,weight:getRandomInt(0,1e3),species:d[i]});for(e.sort(function(n,t){return n.weight-t.weight}),speciesIndex=0,i=0;i<u;i+=2,speciesIndex++){for(c=[],k=e[speciesIndex].species.subSets,l=0;l<k.length;l++)tt=getRandomInt(0,k[l].length-1),c.push({weight:getRandomInt(0,1e3),url:e[speciesIndex].species.subSets[l][tt]});c.sort(function(n,t){return n.weight-t.weight});r.push({setIndex:e[speciesIndex].index,weight:getRandomInt(0,1e3),url:c[0].url,name:e[speciesIndex].species.name});r.push({setIndex:e[speciesIndex].index,weight:getRandomInt(0,1e3),url:c[1].url,name:e[speciesIndex].species.name})}for(r.sort(function(n,t){return n.weight-t.weight}),g=new Date,rt(),i=0;i<u;i++){r[i].index=i;r[i].cardId="#card"+i;a=r[i];console.log(a);$(a.cardId).addClass("cardCovered").on("click",a,function(n){var i;if(!v){v=!0;var r=n.data.cardId,e=n.data.url,t=n.data,h=$(r).hasClass("cardUncovered");$(r).addClass("cardPlaying").removeClass("cardCovered").addClass("cardUncovered");i=new Audio(e);i.onended=function(){if($(t.cardId).removeClass("cardPlaying"),v=!1,h){console.log("Sound finished for already uncovered card: ");console.log(t);return}console.log("Sound finished for card: ");console.log(t);console.log("First selected card: "+f);console.log(f);s<u?(nt++,console.log("matchCount "+s+"; cardCount "+u),f!=null&&f.cardId!=t.cardId?(f.setIndex!=t.setIndex?($(t.cardId).removeClass("cardUncovered"),$(t.cardId).addClass("cardCovered"),$(f.cardId).removeClass("cardUncovered"),$(f.cardId).addClass("cardCovered"),o("mismatch",t.url,t.index)):(s+=2,console.log(s+", "+u),s>=u?(o("finished",t.url,t.index),ft()):o("match",t.url,t.index)),f=null):(o("first",t.url,t.index),f=t)):o("after the win",t.url,t.index)};i.play();console.log("Card selected: ");console.log(t)}})}}$("#nickname").on("change",function(){n()});$("#email").on("change",function(){n()});t(speciesName)})();