function getRandomInt(n,t){return Math.floor(Math.random()*(t-n+1))+n}(function(){function n(){var n=JSON.stringify({nickName:$("#nickname").val(),email:$("#email").val()});$.ajax({url:"/api/players/",type:"post",data:n,dataType:"json",accept:"application/json",contentType:"application/json"})}function t(n){$("#cards").empty();$("#leaderboard").addClass("hidden");$.getJSON("/api/species/"+n,function(n){speciesName=n.name;i(n)})}function i(n){function tt(){var n=new Date,t=n-d,i=JSON.stringify({id:p,duration:t,finishedTime:n,movesCount:g,speciesName:speciesName});$.ajax({url:"/api/games/",type:"post",data:i,dataType:"json",accept:"application/json",contentType:"application/json"})}function o(n,t){var i=new Date,r,u;r=y!=null?i-y:null;u=JSON.stringify({label:n,card:t,time:i,millisecondsSinceLastEvent:r,gameId:p,speciesName:speciesName});y=i;$.ajax({url:"/api/events/",type:"post",data:u,dataType:"json",accept:"application/json",contentType:"application/json",success:function(n){p=n},error:function(n){console.log(n)}})}function it(){$.getJSON("/api/players",function(n){var t="/api/leaderboard/top10/"+speciesName;$.getJSON(t,function(n){$("#leaderboard-table").find("tr:gt(0)").remove();$.each(n.items,function(n,t){$("#leaderboard-table").append("<tr><td>"+t.nickName+"<\/td><td>"+t.movesCount+"<\/td><\/tr>")});$("#leaderboard-name").text(n.name);$("#leaderboard").removeClass("hidden")});n!=null&&($("#nickname").val(n.nickName),$("#email").val(n.email))})}function rt(){if(o("match",a.url),tt(),s>=r)for(var n=0;n<r;n++)console.log(f[n]),$(f[n].cardId).text(f[n].name);$("#next-game").removeClass("hidden").text("next game").off("click").on("click",function(){t("nextrandom")});it()}var k=n.sets,v=!1,r=n.cardCount,ut=n.columnCount,ft=k.length,u=null,s=0,y=null,d=null,p=null,g=0,h,w,f,e,c,b,l,nt,i,a;for($("#game-description").text(n.description),$("#next-game").off("click").addClass("hidden"),h=0,w=0,i=0;i<r;i++)h==0&&(rowId="row"+w,$("#cards").append("<div class='row' id='"+rowId+"'><\/div>")),cardId="card"+i,$("#"+rowId).append("<div class='card cardCovered' id='"+cardId+"'><\/div>"),h++,h==ut&&(w++,h=0);for(f=[],e=[],i=0;i<ft;i++)e.push({index:i,weight:getRandomInt(0,1e3),species:k[i]});for(e.sort(function(n,t){return n.weight-t.weight}),speciesIndex=0,i=0;i<r;i+=2,speciesIndex++){for(c=[],b=e[speciesIndex].species.subSets,l=0;l<b.length;l++)nt=getRandomInt(0,b[l].length-1),c.push({weight:getRandomInt(0,1e3),url:e[speciesIndex].species.subSets[l][nt]});c.sort(function(n,t){return n.weight-t.weight});f.push({setIndex:e[speciesIndex].index,weight:getRandomInt(0,1e3),url:c[0].url,name:e[speciesIndex].species.name});f.push({setIndex:e[speciesIndex].index,weight:getRandomInt(0,1e3),url:c[1].url,name:e[speciesIndex].species.name})}for(f.sort(function(n,t){return n.weight-t.weight}),d=new Date,o("started",null),i=0;i<r;i++){f[i].cardId="#card"+i;a=f[i];console.log(a);$(a.cardId).addClass("cardCovered").on("click",a,function(n){var i;if(!v){v=!0;var f=n.data.cardId,e=n.data.url,t=n.data,h=$(f).hasClass("cardUncovered");$(f).addClass("cardPlaying").removeClass("cardCovered").addClass("cardUncovered");i=new Audio(e);i.onended=function(){if($(t.cardId).removeClass("cardPlaying"),v=!1,h){console.log("Sound finished for already uncovered card: ");console.log(t);return}console.log("Sound finished for card: ");console.log(t);console.log("First selected card: "+u);console.log(u);s<r?(g++,console.log("matchCount "+s+"; cardCount "+r),u!=null&&u.cardId!=t.cardId?(u.setIndex!=t.setIndex?($(t.cardId).removeClass("cardUncovered"),$(t.cardId).addClass("cardCovered"),$(u.cardId).removeClass("cardUncovered"),$(u.cardId).addClass("cardCovered"),o("mismatch",t.url)):(o("match",t.url),s+=2,console.log(s+", "+r),s>=r&&rt()),u=null):(o("first",t.url),u=t)):o("after the win",t.url)};i.play();console.log("Card selected: ");console.log(t)}})}}$("#nickname").on("change",function(){n()});$("#email").on("change",function(){n()});t(speciesName)})();